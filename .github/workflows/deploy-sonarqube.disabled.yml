name: 🚀 Deploy SonarQube desde artifcat

on:
  workflow_dispatch:
    
jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: 📤 Descargar artifact
      uses: actions/download-artifact@v4
      with:
        name: sonarqube-image
        path: /tmp/

    - name: 🐳 Cargar imagen en Docker
      run: |
        gunzip -c /tmp/sonarqube-latest.tar.gz | docker load

    - name: 🔁 Reiniciar contenedor con nueva imagen
      run: |
        docker compose -f apps/sonarqube/config/compose.yaml down || true
        docker compose -f apps/sonarqube/config/compose.yaml up -d