name: ğŸ› ï¸ Build & ğŸš€ Deploy OpenCTI
on:
    workflow_dispatch:
jobs:
    deploy:
        name: ğŸ§ª Deploy OpenCTI
        runs-on: self-hosted

        steps:
            - name: ğŸ“¥ Checkout repo
              uses: actions/checkout@v4
            #- name: ğŸ”§ Establecer vm.max_map_count
            #  run: |
            #    sudo sysctl -w vm.max_map_count=1048575
            #    echo "vm.max_map_count=1048575" | sudo tee -a /etc/sysctl.conf
            - name: ğŸŒ± Exportar variables .env
              run: |
                export $(grep -v '^#' apps/opencti/config/.env | xargs)
            - name: ğŸš€ Deplegar OpenCTI con docker-compose
              run: |
                cd apps/opencti/config/docker
                docker compose down
                docker compose up -d
            - name: ğŸ§ª Comprobar estado de contenedores
              run: docker ps -a
